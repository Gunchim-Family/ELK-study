# 엘라스틱 서치 기본

## 1. 개요
엘라스틱 서치(Elasticsearch)는 분산형 검색 및 분석 엔진으로, JSON 형태의 데이터를 HTTP를 통해 요청하고 응답하는 방식으로 동작합니다.
데이터는 인덱스와 도큐먼트로 관리됩니다.

## 2. 인덱스와 도큐먼트

### 인덱스
- **정의**: RDB에서의 테이블과 유사한 개념으로, 도큐먼트를 저장하는 논리적 구분자입니다.
- **특징**:
    - 동일한 인덱스 내 도큐먼트는 동일한 스키마를 가집니다.
    - 인덱스 용량 제한을 두어 관리하며, 특정 용량이나 도큐먼트 개수에 도달하면 인덱스를 분리합니다.
    - 예: 한 달 단위로 인덱스를 분리하여 관리.

### 도큐먼트
- **정의**: 실제 데이터를 저장하는 기본 단위로, JSON 형태로 저장됩니다.
- **구성**: 여러 필드와 값을 가질 수 있습니다.
- **예시**:
  ```json
  {
    "name": "gunchim",
    "age": 25,
    "gender": "male"
  }
  ```

## 3. 인덱스와 도큐먼트 관리

### 인덱스 관리
- **생성**: `PUT index1`
- **확인**: `GET index1`
- **삭제**: `DELETE index1`
- **인덱스 확인 명령어**: `GET _cat/indices?v`

### 도큐먼트 관리
- **생성**:
  ```bash
  PUT index1/_doc/1
  {
    "name": "mike",
    "age": 25,
    "gender": "male"
  }
  ```
- **조회**:
    - 특정 도큐먼트 조회: `GET index2/_doc/1`
    - 모든 도큐먼트 조회: `GET index2/_search`

### 도큐먼트 특성
- 새로운 도큐먼트에 없는 필드를 추가하면, 인덱스의 매핑 영역에 자동으로 추가됩니다.
- 도큐먼트를 조회하면 저장했던 필드만 출력됩니다.
- 기본 필드 타입과 다른 경우 자동으로 변환하여 저장합니다.
- 도큐먼트 수정 및 삭제는 비용이 많이 들기 때문에 권장하지 않습니다.

### 벌크 인서트
- HTTP 통신을 줄이기 위해 벌크 인서트를 사용합니다.
- 파일 비트(Filebeat)와 연결하여 배치 처리를 통해 비정기적으로 필요하지 않은 데이터를 적재 후 발송합니다.

## 4. 매핑과 분석기

### 매핑
- **정의**: 도큐먼트의 필드 타입을 지정하는 과정.
- **다이나믹 템플릿**: 새로운 필드가 추가될 때 자동으로 필드 타입을 지정하는 기능.

### 분석기
- **정의**: 텍스트를 인덱싱하기 전에 텍스트를 처리하고 변환하는 역할을 하는 구성 요소입니다. 분석기는 입력된 텍스트를 다양한 처리 단계를 거쳐 최종적으로 검색 가능한 용어(terms)로 변환합니다.
- **구성 요소**:
    - **캐릭터 필터**: 문자열 전처리 작업을 수행.
    - **토크나이저**: 문자열을 토큰으로 분리.
    - **토큰 필터**: 토큰 후처리를 수행.

#### 분석기의 동작 과정
1. **캐릭터 필터**: 문자열의 전처리를 담당합니다. 예를 들어, HTML 태그를 제거하거나, 특정 문자를 다른 문자로 변환합니다.
2. **토크나이저**: 전처리된 문자열을 토큰으로 분리합니다. 예를 들어, "I like dogs"라는 문자열을 "I", "like", "dogs"로 분리합니다. 
   - standard(기호 제거), ngram(N개의 연속된 글자 단위를 모두 토큰화), lowercase 등
3. **토큰 필터**: 분리된 토큰을 정제합니다. 예를 들어, 소문자로 변환하거나 불용어(Stop words)를 제거합니다.

### 토큰과 용어
- **토큰**: 분석기에서 일시적으로 존재하는 문자열의 단위입니다. 캐릭터 필터와 토크나이저를 거쳐 생성됩니다.
- **용어**: 정제된 토큰들이 최종적으로 인덱싱되고 검색에 사용되는 단위입니다. 토큰 필터를 거쳐 생성된 후 역인덱스에 저장됩니다.

#### 예시
```bash
POST _analyze
{
  # 스탑 분석기는 불용어를 제거합니다. (예: "The", "10")
  "analyzer": "stop",
  "text": "The 10 most loving dog"
}
```
위 예시에서 "The 10 most loving dog"이라는 텍스트가 입력되면, "The"와 "10"은 스톱 분석기에 의해 제거되고, 나머지 "most", "loving", "dog"가 토큰으로 분리되고, 최종적으로 용어로 저장됩니다.


### 커스텀 분석기
필요에 따라 사용자 정의 분석기를 만들 수 있습니다. 이를 통해 특정 요구사항에 맞춘 문자열 처리 및 인덱싱을 수행할 수 있습니다.
